#
# ~/.profile
#
if ! (declare -f -F pathmunge > /dev/null ); then
	pathmunge () {
		if (test -d "$1") && ! (echo $PATH | /bin/egrep -q "(^|:)$1($|:)") &> /dev/null; then
			if [ "$2" = "after" ] ; then
				PATH=$PATH:$1
			else
				PATH=$1:$PATH
			fi
		fi
	}
fi

command_exists () {
	command -v "$1" &> /dev/null
}

fallback_commands () {
	for command in "$@"
	do
		if command_exists $command; then
			echo $command
			break
		fi
	done
}

# homebrew
export BREW_PREFIX=/opt/homebrew
if [ -d $BREW_PREFIX ]; then
	eval "$($BREW_PREFIX/bin/brew shellenv)"
fi

# rust
if [ -f $HOME/.cargo/env ]; then
	source "$HOME/.cargo/env"
fi

# deno
pathmunge $HOME/.deno/bin

# flutter
pathmunge $HOME/.local/share/flutter/bin

# gcloud sdk
pathmunge $HOME/.local/share/google-cloud-sdk/bin

# golang
pathmunge $HOME/go/bin
pathmunge $HOME/.local/share/go/bin
if command_exists go; then
	pathmunge "$(go env GOBIN)"
	pathmunge "$(go env GOPATH)/bin"
	export GO111MODULE=on
fi

# snapcraft
pathmunge /var/lib/snapd/snap/bin

# node
if command_exists npm; then
	pathmunge "$(npm get prefix)/bin"
fi
if command_exists yarn; then
	pathmunge "$(yarn config get prefix)/bin"
fi

# python
if command_exists python3; then
	alias python=python3
	alias pip="python3 -m pip"
	pathmunge "$(python3 -m site --user-base)/bin"
fi

# ruby
if command_exists ruby && command_exists gem; then
	pathmunge "$(ruby -r rubygems -e 'puts Gem.user_dir')/bin"
fi

# java
# Add function to switch between java versions without source ~/.profile
# Usage: chjava 11
chjava () {
	if command_exists /usr/libexec/java_home; then
		export JAVA_VERSION=$1
		export JAVA_HOME="$(/usr/libexec/java_home)"
		pathmunge "$JAVA_HOME/bin"
	fi
}
chjava 11
alias chjava=". chjava"


# kubernetes
# add all configs in .kube/conf.d
export KUBECONFIG="$HOME/.kube/config"
for i in $(ls $HOME/.kube/conf.d/* 2>/dev/null); do
	export KUBECONFIG=$KUBECONFIG:$i
done
pathmunge "${KREW_ROOT:-$HOME/.krew}/bin"
alias k="kubectl"

# MANPAGER, EDITOR
export EDITOR="$(fallback_commands nvim vim vi)"
if command_exists bat; then
	export MANPAGER="sh -c 'col -bx | bat -l man -p'"
fi

# miscs
pathmunge ~/bin
pathmunge '/Users/user/Library/Application Support/JetBrains/Toolbox/scripts'
alias wget="curl -O --continue-at -"

